<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>하은&하민ATM</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <style>
    /* 기본 리셋 */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Apple SD Gothic Neo", system-ui, sans-serif;
      background: linear-gradient(180deg, #dff3ff 0%, #cce9ff 50%, #bfe0ff 100%);
      display:flex; align-items:center; justify-content:center;
      color:#213854; -webkit-font-smoothing:antialiased;
      overflow:hidden;
    }

    @keyframes bgShift {
      0% { background-position: 0% 30%; }
      50% { background-position: 100% 70%; }
      100% { background-position: 0% 30%; }
    }
    body { background-size: 200% 200%; animation: bgShift 18s ease-in-out infinite; }

    /* 앱 컨테이너 */
    #app {
      width: 92%; max-width: 900px; height: 92vh; max-height: 1200px;
      background: rgba(255,255,255,0.98); border-radius: 28px;
      box-shadow: 0 18px 40px rgba(20,60,120,0.12);
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      padding:28px; position:relative; overflow:hidden;
    }

    /* 화면 공통 */
    .screen {
      width:100%; height:100%; position:absolute; inset:0;
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      text-align:center; padding:24px; transition: opacity 300ms ease, transform 350ms ease;
      opacity:0; transform: translateY(10px); pointer-events:none;
    }
    .screen.active { opacity:1; transform: translateY(0); pointer-events:auto; }

    .title { font-size:2.6rem; font-weight:900; color:#2f77d6; margin-top:8px; }
    .subtitle { font-size:1.05rem; color:#2f4f6f; margin-top:8px; }

    /* 첫 화면 텍스트 */
    .start-text {
      font-size:1.6rem;
      font-weight:700;
      color:#234067;
    }

    /* 스플래시 이미지 */
    .splash-image {
      width:260px; height:260px; border-radius:50%;
      background-image: url("splash.png"); /* 같은 폴더에 splash.png 두기 */
      background-size: cover; background-position: center;
      box-shadow: 0 10px 24px rgba(45,100,190,0.12); display:block; margin-bottom:18px;
      transform-origin:center; animation: pulse 2.6s ease-in-out infinite;
    }
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.035); }
      100% { transform: scale(1); }
    }

    /* 키패드 */
    .keypad { display:grid; grid-template-columns: repeat(3, 1fr); gap:12px; width:100%; max-width:360px; margin-top:20px; }
    .key {
      background:#e9f6ff; color:#15406c; border-radius:16px; border:none;
      padding:16px 0; font-weight:700; font-size:1.25rem; cursor:pointer;
      box-shadow: 0 6px 12px rgba(30,80,150,0.06); transition: transform 120ms ease;
    }
    .key:active { transform: translateY(3px) scale(0.995); background:#d2edff; }

    .password-display { font-size:2rem; letter-spacing:0.6rem; margin-top:8px; color:#0f3558; }

    /* 금액 버튼 */
    .amount-grid { display:grid; grid-template-columns:repeat(2,1fr); gap:14px; width:100%; max-width:420px; margin-top:16px; }
    .amount-btn {
      background: linear-gradient(180deg,#6FB8FF 0%,#4A90E2 100%);
      color:white; border:none; border-radius:18px; padding:14px 8px;
      font-size:1.15rem; font-weight:800; cursor:pointer;
      box-shadow: 0 8px 18px rgba(74,144,226,0.18);
      transition: transform 140ms ease;
    }
    .amount-btn:active { transform: translateY(3px) scale(0.995); }

    /* 카드 슬롯 */
    .card-insert-container { display:flex; flex-direction:column; align-items:center; gap:16px; }
    .arrow { font-size:4.2rem; color:#2f77d6; animation: bob 1s infinite; }
    @keyframes bob { 0%,100%{transform:translateY(0)} 50%{transform:translateY(10px)} }

    .card-slot {
      width:72%; max-width:520px; height:58px; border-radius:20px;
      background: linear-gradient(180deg,#4e6b8a 0%, #24394f 100%); position:relative;
      box-shadow: inset 0 6px 12px rgba(0,0,0,0.35); transition: box-shadow .25s ease;
    }
    .card-slot.glow { box-shadow: 0 10px 30px rgba(74,144,226,0.28), inset 0 6px 14px rgba(0,0,0,0.35); }

    .card {
      width:68%; height:46px; border-radius:12px;
      background: linear-gradient(135deg,#bfe9ff,#78c8ff);
      position:absolute; left:16%; top:-10px; box-shadow: 0 10px 22px rgba(10,70,130,0.22);
      transform: translateY(-50px); transition: transform 700ms cubic-bezier(.2,.9,.3,1), opacity .3s;
      opacity:0;
    }
    .card.inserted { transform: translateY(18px); opacity:1; }
    .card.removed { transform: translateY(-120px); opacity:0; }

    .card-text { margin-top:8px; font-weight:700; color:#1f3b57; min-height:1.4rem; }

    /* 모달 오버레이 & 박스 */
    .modal-overlay {
      position: fixed; inset:0; display:flex; align-items:center; justify-content:center;
      background: rgba(8,24,48,0.35); z-index:60;
    }
    .modal {
      width: min(92%, 420px);
      background:white; padding:20px; border-radius:14px;
      box-shadow:0 14px 40px rgba(20,60,120,0.18); text-align:center;
      display:flex; flex-direction:column; gap:14px;
    }
    .modal-text { font-size:1rem; color:#213854; }

    .modal-actions { width:100%; display:flex; gap:10px; justify-content:center; }
    .modal .btn {
      width:100%;
      padding:14px 12px;
      font-size:1.05rem;
      border-radius:12px;
      border: none;
      background:#4A90E2;
      color: #fff;
      font-weight:800;
      box-shadow: 0 8px 18px rgba(74,144,226,0.18);
      cursor:pointer;
      transition: transform .12s ease;
    }
    .modal .btn:active { transform: translateY(2px); box-shadow: 0 6px 12px rgba(74,144,226,0.12); }

    /* 숨김 클래스 */
    .hidden { display:none !important; }

    /* 반응형(아이패드 전용) */
    @media (min-width:768px) {
      #app { max-width:1000px; height:88vh; padding:36px; }
      .title { font-size:3rem; }
      .splash-image { width:320px; height:320px; }
      .password-display { font-size:2.6rem; }
      .card-slot { height:72px; border-radius:24px; }
      .card { height:56px; left:14%; top:-18px; border-radius:14px; }
      .amount-grid { max-width:580px; gap:18px; }
    }
  </style>
</head>
<body>
  <div id="app">
    <!-- 1. 첫 화면: 텍스트만 -->
    <div id="screen-start" class="screen active">
      <div class="start-text">화면을 터치해주세요</div>
    </div>

    <!-- 2. 스플래시: 이미지 + 막둥이ATM -->
    <div id="screen-splash" class="screen">
      <div class="splash-image" role="img" aria-label="막둥이 이미지"></div>
      <div class="title">하은&하민ATM</div>
    </div>

    <!-- 3. 비밀번호 -->
    <div id="screen-password" class="screen">
      <div class="title">하은&하민ATM</div>
      <div class="subtitle">비밀번호를 입력하세요</div>
      <div id="password-display" class="password-display"></div>
      <div id="password-error" style="color:#d04a4a; min-height:1.2rem;"></div>

      <div class="keypad">
        <button class="key" data-key="1">1</button>
        <button class="key" data-key="2">2</button>
        <button class="key" data-key="3">3</button>
        <button class="key" data-key="4">4</button>
        <button class="key" data-key="5">5</button>
        <button class="key" data-key="6">6</button>
        <button class="key" data-key="7">7</button>
        <button class="key" data-key="8">8</button>
        <button class="key" data-key="9">9</button>
        <button class="key key-special" data-key="clear">지움</button>
        <button class="key" data-key="0">0</button>
        <button class="key key-special" data-key="back">←</button>
      </div>
    </div>

    <!-- 4. 금액 선택 -->
    <div id="screen-amount" class="screen">
      <div class="title">하은&하민ATM</div>
      <div class="subtitle">원하시는 금액을 선택하세요</div>
      <div class="amount-grid">
        <button class="amount-btn" data-amount="10000">10,000원</button>
        <button class="amount-btn" data-amount="100000">100,000원</button>
        <button class="amount-btn" data-amount="20000">20,000원</button>
        <button class="amount-btn" data-amount="200000">200,000원</button>
        <button class="amount-btn" data-amount="30000">30,000원</button>
        <button class="amount-btn" data-amount="300000">300,000원</button>
        <button class="amount-btn" data-amount="40000">40,000원</button>
        <button class="amount-btn" data-amount="400000">400,000원</button>
        <button class="amount-btn" data-amount="50000">50,000원</button>
        <button class="amount-btn" data-amount="500000">500,000원</button>
      </div>
    </div>

    <!-- 5. 카드 화면 -->
    <div id="screen-card" class="screen">
      <div class="title">하은&하민ATM</div>
      <div class="card-insert-container">
        <div class="subtitle">아래 화살표 방향으로</div>
        <div class="subtitle">카드를 넣어주세요</div>
        <div class="arrow">⬇</div>

        <div class="card-slot" id="card-slot">
          <div class="card" id="atm-card"></div>
        </div>

        <div id="card-text" class="card-text">카드를 넣어주세요</div>
      </div>
    </div>
  </div>

  <!-- 모달 -->
  <div id="modal-overlay" class="modal-overlay hidden" style="display:none;">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-text">
      <div id="modal-text" class="modal-text">메시지 내용</div>
      <div class="modal-actions">
        <button id="modal-close" class="btn">확인</button>
      </div>
    </div>
  </div>

  <script>
    /* 요소 */
    const screens = {
      start: document.getElementById("screen-start"),
      splash: document.getElementById("screen-splash"),
      password: document.getElementById("screen-password"),
      amount: document.getElementById("screen-amount"),
      card: document.getElementById("screen-card")
    };
    const modalOverlay = document.getElementById("modal-overlay");
    const modalText = document.getElementById("modal-text");
    const modalClose = document.getElementById("modal-close");
    const CORRECT_PASSWORD = "1203";
    let currentPassword = "";
    let cardTimer = null;
    const cardTextEl = document.getElementById("card-text");
    const atmCard = document.getElementById("atm-card");
    const cardSlot = document.getElementById("card-slot");

    /* TTS */
    function chooseYunaVoice() {
      const voices = window.speechSynthesis.getVoices() || [];
      const y = voices.find(v => v.name && /유나|yuna/i.test(v.name));
      if (y) return y;
      const ko = voices.find(v => v.lang && v.lang.toLowerCase().includes("ko"));
      return ko || voices[0] || null;
    }
    function speak(text) {
      if (!("speechSynthesis" in window) || !text) return;
      window.speechSynthesis.cancel();
      const u = new SpeechSynthesisUtterance(text);
      const v = chooseYunaVoice();
      if (v) u.voice = v;
      u.lang = v?.lang || "ko-KR";
      u.rate = 1.00; u.pitch = 1.00;
      window.speechSynthesis.speak(u);
    }
    if (typeof speechSynthesis !== "undefined") {
      speechSynthesis.onvoiceschanged = () => { /* no-op */ };
    }

    /* 화면 전환 */
    function setActiveScreen(name) {
      atmCard.classList.remove("inserted","removed");
      cardSlot.classList.remove("glow");
      if (cardTimer) { clearTimeout(cardTimer); cardTimer = null; }

      Object.values(screens).forEach(s => s.classList.remove("active"));
      if (screens[name]) screens[name].classList.add("active");

      if (name === "amount") {
        speak("원하시는 금액을 선택해 주세요.");
      }
      if (name === "card") {
        speak("아래 화살표 방향으로 카드를 넣어 주세요.");
        setTimeout(() => {
          cardSlot.classList.add("glow");
          atmCard.classList.add("inserted");
        }, 280);
        cardTimer = setTimeout(() => {
          cardTextEl.textContent = "출금이 완료되었습니다.";
          speak("출금이 완료되었습니다.");
          setTimeout(() => {
            atmCard.classList.remove("inserted");
            atmCard.classList.add("removed");
            cardSlot.classList.remove("glow");
          }, 700);
        }, 10000);
      }
    }

    /* 1단계: 첫 화면 터치 → "막둥이 에이티엠입니다." + 스플래시로 */
    screens.start.addEventListener("click", () => {
      speak("하은,하민 에이티엠입니다.");
      setActiveScreen("splash");
    });

    /* 2단계: 스플래시 터치 → "비밀번호를 입력해 주세요." + 비밀번호 화면 */
    screens.splash.addEventListener("click", () => {
      speak("비밀번호를 입력해 주세요.");
      setActiveScreen("password");
    });

    /* 비밀번호 */
    const passwordDisplay = document.getElementById("password-display");
    const passwordError = document.getElementById("password-error");

    function renderPassword() {
      passwordDisplay.textContent = "•".repeat(currentPassword.length);
    }

    function resetPassword(msg = "") {
      currentPassword = "";
      renderPassword();
      passwordError.textContent = msg;
      if (msg) speak(msg);
    }

    function checkPasswordComplete() {
      if (currentPassword === CORRECT_PASSWORD) {
        setActiveScreen("amount");
        resetPassword("");
      } else {
        resetPassword("틀렸습니다. 다시 입력해 주세요.");
      }
    }

    document.querySelectorAll(".key").forEach(k => {
      k.addEventListener("click", () => {
        const key = k.dataset.key;
        if (key === "clear") {
          resetPassword("");
          return;
        }
        if (key === "back") {
          currentPassword = currentPassword.slice(0,-1);
          renderPassword();
          return;
        }
        if (currentPassword.length >= 4) return;
        currentPassword += key;
        renderPassword();
        if (currentPassword.length === 4) checkPasswordComplete();
      });
    });

    /* 금액선택 */
    document.querySelectorAll(".amount-btn").forEach(btn => {
      btn.addEventListener("click", () => {
        const amount = Number(btn.dataset.amount);
        if (amount === 200000) {
          setActiveScreen("card");
        } else if (amount < 200000) {
          showModal("더 높은 금액을 선택하세요.");
        } else {
          showModal("낮은 금액을 선택하세요.");
        }
      });
    });

    /* 모달 */
    function showModal(msg) {
      modalText.textContent = msg;
      modalOverlay.style.display = "flex";
      modalOverlay.classList.remove("hidden");
      speak(msg);
    }
    function hideModal() {
      modalOverlay.style.display = "none";
      modalOverlay.classList.add("hidden");
    }
    modalClose.addEventListener("click", hideModal);
    modalOverlay.addEventListener("click", (e) => {
      if (e.target === modalOverlay) hideModal();
    });

    /* 초기: 첫 화면 */
    setActiveScreen("start");
  </script>
</body>
</html>
